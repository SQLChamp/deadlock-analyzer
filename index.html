<!DOCTYPE html>
<html>
<head>
    <title>Azure Function Call with AAD Auth</title>
</head>
<body>
    <h1>Test Azure Function Auth</h1>
    <button onclick="callFunction()">Call Function</button>

    <script src="https://alcdn.msauth.net/browser/2.38.0/js/msal-browser.min.js"></script>
    <script>
        const msalConfig = {
            auth: {
                clientId: "bdd571e6-401c-40ef-b704-2a618b55a4a5",  
                authority: "https://login.microsoftonline.com/c39f9911-9333-418b-b6eb-f739a9e2aa90",
                redirectUri: window.location.origin
            }
        };

        const msalInstance = new msal.PublicClientApplication(msalConfig);

        async function callFunction() {
            const account = msalInstance.getAllAccounts()[0];
            if (!account) {
                await msalInstance.loginPopup({ scopes: ["api://YOUR_SERVER_APP_ID/user_impersonation"] });
            }

            const tokenResponse = await msalInstance.acquireTokenSilent({
                scopes: ["api://57fce872-de7d-4102-b505-c2f328f7f7ab/user_impersonation"],
                account: msalInstance.getAllAccounts()[0]
            }).catch(() => msalInstance.acquireTokenPopup({ scopes: ["api://57fce872-de7d-4102-b505-c2f328f7f7ab/user_impersonation"] }));

            const token = tokenResponse.accessToken;

            const response = await fetch("https://deadlock-analyzer-function-dhhef4hvhbgxcyg9.canadacentral-01.azurewebsites.net/api/DeadlockAnalyzer", {
                headers: {
                    "Authorization": `Bearer ${token}`
                }
            });

            const data = await response.json();
            console.log(data);
            alert(JSON.stringify(data));
        }
    </script>
</body>
</html>
